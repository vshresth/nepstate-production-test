!function(t){t(document).on("click",".mark-as-sold",(function(e){e.preventDefault();var r=this,a=t(r),n={action:"rtcl_mark_as_sold_unsold",post_id:parseInt(a.attr("data-id"),10),__rtcl_wpnonce:rtcl.__rtcl_wpnonce};n.post_id&&!a.hasClass("working")&&t.ajax({url:rtcl.ajaxurl,data:n,type:"POST",beforeSend:function(){a.addClass("working")},success:function(e){a.removeClass("working"),e.target=r,e.success&&(a.attr("data-title",e.data.text).attr("data-tooltip",e.data.text).html(e.data.text),"sold"===e.data.type?a.addClass("sold"):a.removeClass("sold")),t(document).trigger("rtcl.mark_as_sold",e)},error:function(e){t(document).trigger("rtcl.mark_as_sold.error",{listing_id:n.post_id,target:r}),a.removeClass("working")}})})),t.fn.validate&&(t(".rtcl #commentform").validate({submitHandler:function(e){var r,a=t(e),n=a.find("#rating"),s=n.parent(".form-group"),o=n.val(),c=t('<div class="alert" />'),l=t("#comments"),i=t(".comment-list"),d=(t("#cancel-comment-reply-link"),a.find(".btn"));if(n.length>0&&!o)return s.addClass("has-danger"),s.find(".with-errors").remove(),s.append('<div class="with-errors help-block">'+rtcl.i18n_required_rating_text+"</div>"),!1;var p=new FormData(e);return p.append("action","rtcl_ajax_submit_comment"),t.ajax({url:rtcl.ajaxurl,data:p,type:"POST",dataType:"json",cache:!1,processData:!1,contentType:!1,beforeSend:function(){t('<span class="rtcl-icon-spinner animate-spin"></span>').insertAfter(a.find(".btn")),d.val("Loading...").prop("disabled",!0),a.next(".alert").remove()},success:function(n){a.find(".btn").next(".rtcl-icon-spinner").remove(),d.prop("disabled",!1),c.html(n.message).insertAfter(a),n.error?c.addClass("alert-danger"):(c.addClass("alert-success"),n.comment_id&&t("#li-comment-"+n.comment_id).slideUp(250,(function(){t(this).remove()})),i.length>0?i.append(n.comment_html):(r='<ol class="comment-list">'+n.comment_html+"</ol>",l.append(t(r))),e.reset(),a.find("p.stars").removeClass("selected"))},complete:function(){d.val("Submit").prop("disabled",!1)},error:function(t,e,r){if(a.next(".rtcl-icon-spinner").remove(),d.val("Submit").prop("disabled",!1),500===e)alert("Error while adding comment");else if("timeout"===e)alert("Error: Server doesn't respond.");else{var n=t.responseText.split("<p>")[1].split("</p>");alert(n[0])}}}),!1}}),t(".rtcl-sub-item[data-gateway=authorizenet] #rtcl-sub-update-payment").validate({submitHandler:function(e){var r=new FormData(e);r.append("action","rtcl_subscription_update_payment"),r.append("__rtcl_wpnonce",rtcl.__rtcl_wpnonce);var a=t(e).parents(".rtcl-sub-item");return t.ajax({url:rtcl.ajaxurl,data:r,type:"POST",dataType:"json",cache:!1,processData:!1,contentType:!1,beforeSend:function(){a.rtclBlock()},success:function(t){console.log(t),t.success?(e.reset(),a.find(".sub-payment-update-wrap").slideUp("slow"),toastr.success(t.data.message)):toastr.error(t.data)},complete:function(){a.rtclUnblock()},error:function(t,e,r){toastr.error("Error while updating subscription")}}),!1}})),t(".rtcl-rating-filter .ui-link-tree-item").on("click",(function(){var e=t(this),r=e.data("id")||0,a=e.parents(".ui-accordion-content"),n=a.find("input[type=hidden]");e.hasClass("selected")?(a.find("li").removeClass("selected"),n.val("")):(a.find("li").removeClass("selected"),e.addClass("selected"),n.val(r)),e.closest("form").submit()})),t(document).on("click",".rtcl-subs-reports .rtcl-sub-cancel",(function(e){e.preventDefault();var r=t(this),a=r.data("id");if(a){if(confirm(rtcl.confirm_text)){var n=r.parents(".rtcl-sub-item"),s=new FormData;s.append("action","rtcl_subscription_cancel"),s.append("id",a),s.append("__rtcl_wpnonce",rtcl.__rtcl_wpnonce),t.ajax({url:rtcl.ajaxurl,data:s,type:"POST",dataType:"json",cache:!1,processData:!1,contentType:!1,beforeSend:function(){n.rtclBlock()},success:function(e){!0===e.success?(t(document).find(".rtcl-sub-item[data-id="+a+"]").remove(),toastr.success(e.data.message)):toastr.error(e.data)},complete:function(){n.rtclUnblock()},error:function(t,e,r){toastr.error("Error while canceling subscription")}})}}else toastr.error("Subscription is not defined");return!1})).on("click",".rtcl-subs-reports .update-card-info",(function(e){return e.preventDefault(),t(this).parents(".rtcl-subs-reports").find(".sub-payment-update-wrap").slideToggle("slow"),!1}))}(jQuery);
